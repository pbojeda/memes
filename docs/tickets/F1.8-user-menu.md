# F1.8: Create User Menu Component

**Sprint:** 1
**Type:** Frontend - Feature
**Priority:** Medium
**Status:** In Progress
**Branch:** feature/sprint1-F1.8-user-menu
**Created:** 2026-02-09
**Dependencies:** F1.1 (authStore) âœ…

---

## Description

Create a `UserMenu` component that integrates into the Header to provide auth-aware navigation. When authenticated, it shows a dropdown menu with the user's email, role badge, and logout action. When unauthenticated, it shows Login and Register links.

The component uses Radix UI DropdownMenu (already available via `radix-ui` package) for accessible dropdown behavior, and reads auth state from the existing Zustand `authStore`.

---

## Acceptance Criteria

- [x] `UserMenu` component renders Login/Register links when user is unauthenticated
- [x] `UserMenu` component renders a dropdown trigger with user initial when authenticated
- [x] Dropdown menu shows user email and role badge
- [x] Dropdown menu has a working Logout button that calls `authService.logout()`
- [x] `UserMenu` integrates into the existing `Header` component (desktop and mobile)
- [x] Component handles hydration correctly (uses `useAuthStore.persist.rehydrate()`)
- [x] Unit tests for UserMenu component (authenticated, unauthenticated, logout)
- [x] Existing Header tests still pass
- [x] All tests pass (134/134)
- [x] Build succeeds

---

## Files to Create/Modify

| File | Purpose |
|------|---------|
| `components/auth/UserMenu.tsx` | New: User menu component with Radix DropdownMenu |
| `components/auth/UserMenu.test.tsx` | New: Tests for UserMenu |
| `components/ui/dropdown-menu.tsx` | New: shadcn/ui wrapper for Radix DropdownMenu |
| `components/layout/Header.tsx` | Modify: Integrate UserMenu into header |
| `components/layout/Header.test.tsx` | Modify: Update tests for auth-aware header |
| `docs/project_notes/key_facts.md` | Update: Add UserMenu to reusable components list |

---

## Implementation Steps

### Step 1: Add shadcn/ui DropdownMenu component

Create `components/ui/dropdown-menu.tsx` following shadcn/ui pattern - a thin wrapper around `@radix-ui/react-dropdown-menu` with Tailwind styling. This follows the existing pattern of `button.tsx`, `card.tsx`, etc.

### Step 2: Write UserMenu tests (TDD - Red)

Create `components/auth/UserMenu.test.tsx` with tests:

**Unauthenticated state:**
1. Should render Login link pointing to `/login`
2. Should render Register link pointing to `/register`
3. Should NOT render dropdown trigger

**Authenticated state:**
4. Should render dropdown trigger with user initial (first letter of email)
5. Should NOT render Login/Register links
6. Should show user email in dropdown content
7. Should show user role badge in dropdown content
8. Should call `authService.logout()` when Logout is clicked
9. Should redirect to `/login` after logout

**Hydration:**
10. Should call `rehydrate()` on mount
11. Should show loading state while hydrating

### Step 3: Implement UserMenu (TDD - Green)

Create `components/auth/UserMenu.tsx`:
- `"use client"` directive
- Read `user`, `isAuthenticated` from `useAuthStore`
- Handle hydration with `useAuthStore.persist.rehydrate()` on mount (same pattern as ProtectedRoute)
- Unauthenticated: render `<Link>` elements for Login/Register
- Authenticated: render Radix DropdownMenu with:
  - Trigger: circle button with user initial (first letter of email, uppercased)
  - Content: user email (non-interactive), role badge, separator, Logout button
- Logout calls `authService.logout()` then redirects to `/login`

### Step 4: Integrate UserMenu into Header

Modify `components/layout/Header.tsx`:
- Import and render `<UserMenu />` in the desktop nav area (right side)
- Add `<UserMenu />` to mobile menu as well
- Remove or keep existing nav structure; UserMenu sits alongside nav links

### Step 5: Update Header tests

Update `components/layout/Header.test.tsx`:
- Mock `UserMenu` component to keep Header tests focused
- Verify UserMenu is rendered in the Header

---

## Technical Notes

- **Radix UI DropdownMenu** is already available (`radix-ui@1.4.3` includes `@radix-ui/react-dropdown-menu`)
- **Hydration pattern**: Must use `skipHydration: true` pattern - same as ProtectedRoute (`useState` for `isHydrated`, call `rehydrate()` in `useEffect`)
- **AuthUser type** has: `id`, `email`, `firstName`, `lastName`, `role`, `isActive`, `emailVerifiedAt`, `lastLoginAt`, `createdAt`
- **UserRole** values: `"TARGET" | "MANAGER" | "ADMIN" | "MARKETING"`
- **authService.logout()** already handles clearing the store
- Follow existing component patterns (LoginForm, ProtectedRoute) for consistency
- Use Tailwind classes for styling, consistent with rest of project

---

## Definition of Done

- [x] All acceptance criteria met
- [x] Unit tests written and passing (10 UserMenu + 6 Header)
- [x] Code follows project standards
- [x] No linting errors
- [x] Build succeeds

---

*Ticket created: 2026-02-09*
