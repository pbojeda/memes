# B0.4: Configure Zod for env validation

**Sprint:** 0
**Type:** Backend - Setup
**Priority:** High
**Status:** Ready for Review
**Branch:** feature/sprint0-B0.4-zod-env
**Created:** 2026-02-03
**Dependencies:** None (independent task)

---

## Description

Configure Zod for environment variable validation. This ensures all required environment variables are present and correctly typed at application startup, preventing runtime errors from missing configuration.

---

## Acceptance Criteria

- [x] Zod installed and configured
- [x] Environment schema defined with all required variables
- [x] Validation runs at application startup
- [x] Clear error messages for missing/invalid variables
- [x] Type-safe access to environment variables
- [x] Schema exported for use throughout the application

---

## Files to Create/Modify

| File | Purpose |
|------|---------|
| `backend/src/config/env.ts` | Zod schema and validated env export |
| `backend/src/config/env.test.ts` | Tests for env validation |
| `backend/src/config/index.ts` | Config module barrel export |
| `backend/src/server.ts` | Import env config at startup |

---

## Dependencies

### Production
```json
{
  "zod": "^3.x"
}
```

---

## Test Specifications (TDD)

```typescript
// backend/src/config/env.test.ts
describe('Environment Config', () => {
  it('should export env object', () => {
    expect(env).toBeDefined();
  });

  it('should have NODE_ENV', () => {
    expect(env.NODE_ENV).toBeDefined();
  });

  it('should have PORT as number', () => {
    expect(typeof env.PORT).toBe('number');
  });

  it('should have DATABASE_URL', () => {
    expect(env.DATABASE_URL).toBeDefined();
  });
});
```

---

## Environment Variables to Validate

| Variable | Type | Required | Default |
|----------|------|----------|---------|
| NODE_ENV | enum | Yes | development |
| PORT | number | Yes | 3000 |
| DATABASE_URL | string | Yes | - |
| LOG_LEVEL | enum | No | debug |
| JWT_SECRET | string | Yes (prod) | - |

---

## Definition of Done

- [x] All tests pass (17 tests)
- [x] TypeScript compiles without errors
- [x] App fails fast on missing required env vars
- [x] Code validated by production-code-validator
- [x] Type-safe env access throughout app

---

## Notes

### Implementation Notes (2026-02-03)
- Zod 3.x for runtime validation with TypeScript type inference
- Schema validates: NODE_ENV, PORT, DATABASE_URL, LOG_LEVEL, JWT_*, REDIS_URL
- Updated prisma.ts to use validated env instead of process.env
- Logger keeps process.env access (needed before validation for error reporting)
- Additional env vars (Stripe, Printful, etc.) will be added when those features are implemented

---

*Ticket created: 2026-02-03*
