# F2.1: Create Product Types Service

**Sprint:** 2
**Type:** Frontend - Feature
**Priority:** High
**Status:** In Progress
**Branch:** feature/sprint2-F2.1-product-types-service
**Created:** 2026-02-10
**Dependencies:** B2.3 (product type endpoints) - completed

---

## Description

Create a frontend service layer for product type CRUD operations. This service will be the primary interface between React components and the backend product-types API. It follows the existing pattern established by `authService` — using `apiClient` (axios wrapper) with auto-generated types from `api-spec.yaml`.

The service needs to support:
- Public listing of product types (with optional `isActive` filter)
- Admin-only create, update, and delete operations

---

## Acceptance Criteria

- [x] `productTypeService` object exported with 4 methods: `getAll`, `create`, `update`, `delete`
- [x] `getAll` accepts optional `isActive` filter and returns `ProductType[]`
- [x] `create` accepts `CreateProductTypeRequest` and returns `ProductType`
- [x] `update` accepts `id` + `UpdateProductTypeRequest` and returns `ProductType`
- [x] `delete` accepts `id` and returns `void`
- [x] All methods use types from auto-generated `lib/api/types.ts`
- [x] Service re-exported from `lib/services/index.ts`
- [x] Unit tests for all 4 methods (success + error cases) — 13 tests
- [x] All tests pass (147 total, 16 suites)
- [x] Build succeeds

---

## Files to Create/Modify

| File | Purpose |
|------|---------|
| `frontend/lib/services/productTypeService.ts` | Product type CRUD service |
| `frontend/lib/services/productTypeService.test.ts` | Unit tests for the service |
| `frontend/lib/services/index.ts` | Add re-export for productTypeService |

---

## Implementation Steps

### Step 1: Create productTypeService.ts
1. Import `apiClient` from `../api/client`
2. Import types from `../api/types`: `ProductType`, `CreateProductTypeRequest`, `UpdateProductTypeRequest`
3. Export `productTypeService` object with methods:
   - `getAll(params?)` — `GET /product-types` with optional `?isActive=true/false`
   - `create(data)` — `POST /product-types`
   - `update(id, data)` — `PATCH /product-types/:id`
   - `delete(id)` — `DELETE /product-types/:id`

### Step 2: Update barrel export
1. Add `export { productTypeService } from './productTypeService'` to `index.ts`

### Step 3: Write Tests
1. Mock `apiClient` (get, post, patch, delete)
2. Test `getAll` — success, with isActive filter, error propagation
3. Test `create` — success, error propagation
4. Test `update` — success, error propagation
5. Test `delete` — success, error propagation

---

## Technical Notes

- **Pattern reference:** Follow `authService.ts` pattern — plain exported object, async methods, no store interaction (product types don't need global state in this task)
- **Types:** Use `components['schemas']['ProductType']`, `components['schemas']['CreateProductTypeRequest']`, `components['schemas']['UpdateProductTypeRequest']` from auto-generated types
- **Error handling:** Let `ApiException` from the axios interceptor propagate naturally — no try/catch needed in this service (unlike authService which manages store state)
- **API paths:** Backend routes are mounted at `/product-types` relative to API base URL
- **No store needed:** Product type caching/store is out of scope for this task — components will call the service directly

---

## Implementation Plan

### Overview

TDD approach: write complete test file first (RED), implement service (GREEN), update barrel export. The service is a pure API wrapper — no store interaction, no try/catch (errors propagate from axios interceptor as `ApiException`).

### Type Imports from `lib/api/types.ts`

```typescript
import type { components } from '../api/types';

type ProductType = components['schemas']['ProductType'];
type CreateProductTypeRequest = components['schemas']['CreateProductTypeRequest'];
type UpdateProductTypeRequest = components['schemas']['UpdateProductTypeRequest'];
```

### Method Signatures

```typescript
export const productTypeService = {
  async getAll(params?: { isActive?: boolean }): Promise<ProductType[]>,
  async create(data: CreateProductTypeRequest): Promise<ProductType>,
  async update(id: string, data: UpdateProductTypeRequest): Promise<ProductType>,
  async delete(id: string): Promise<void>,
};
```

API mapping:
- `getAll` → `GET /product-types` with optional `?isActive=true|false`
- `create` → `POST /product-types`
- `update` → `PATCH /product-types/:id`
- `delete` → `DELETE /product-types/:id`

### Step 1: Create test file (RED)

**File**: `frontend/lib/services/productTypeService.test.ts`

Mock setup pattern (from authService.test.ts):
```typescript
jest.mock('../api/client', () => ({
  apiClient: { get: jest.fn(), post: jest.fn(), patch: jest.fn(), delete: jest.fn() },
}));
```

**13 test cases:**

| # | Method | Test | Key assertion |
|---|--------|------|---------------|
| 1 | getAll | returns product types | `expect(result).toEqual([...])` |
| 2 | getAll | passes isActive filter | `expect(mockApiClient.get).toHaveBeenCalledWith('/product-types', { params: { isActive: true } })` |
| 3 | getAll | returns empty array | `expect(result).toEqual([])` |
| 4 | getAll | propagates ApiException | `rejects.toThrow(ApiException)` |
| 5 | create | returns created product type | `expect(mockApiClient.post).toHaveBeenCalledWith('/product-types', createData)` |
| 6 | create | propagates validation error | `rejects.toThrow(ApiException)` |
| 7 | update | returns updated product type | `expect(mockApiClient.patch).toHaveBeenCalledWith('/product-types/:id', data)` |
| 8 | update | propagates not found | `rejects.toThrow(ApiException)` |
| 9 | update | propagates forbidden | `rejects.toThrow(ApiException)` |
| 10 | delete | calls DELETE endpoint | `expect(mockApiClient.delete).toHaveBeenCalledWith('/product-types/:id')` |
| 11 | delete | returns void | `expect(result).toBeUndefined()` |
| 12 | delete | propagates not found | `rejects.toThrow(ApiException)` |
| 13 | delete | propagates conflict | `rejects.toThrow(ApiException)` with status 409 |

### Step 2: Implement service (GREEN)

**File**: `frontend/lib/services/productTypeService.ts`

- `getAll`: `apiClient.get<{ data: ProductType[] }>('/product-types', { params: params ?? {} })` → return `response.data.data`
- `create`: `apiClient.post<{ data: ProductType }>('/product-types', data)` → return `response.data.data`
- `update`: `apiClient.patch<{ data: ProductType }>('/product-types/${id}', data)` → return `response.data.data`
- `delete`: `apiClient.delete('/product-types/${id}')` → return void

### Step 3: Update barrel export

Add `export { productTypeService } from './productTypeService'` to `frontend/lib/services/index.ts`

### Step 4: Verify

Run tests, lint, build.

---

## Definition of Done

- [x] All acceptance criteria met
- [x] Unit tests written and passing
- [x] Code follows project standards
- [x] No linting errors
- [x] Build succeeds

---

*Ticket created: 2026-02-10*
