# B2.1: Create ProductType model and migration

**Sprint:** 2
**Type:** Backend - Model
**Priority:** High
**Status:** In Progress
**Branch:** feature/sprint2-B2.1-product-type-model
**Created:** 2026-02-09
**Dependencies:** None (Sprint 1 backend complete)

---

## Description

Add the `ProductType` model to the Prisma schema and create the database migration. ProductType represents product categories (t-shirt, hoodie, mug, etc.) with localized names (JSONB), a URL slug, size support flag, active status, and sort order. This model is the foundation for Sprint 2's product type management feature.

The schema is already fully defined in `ai-specs/specs/data-model.md` (section 3.3). This task implements it in Prisma and verifies the migration works correctly.

---

## Acceptance Criteria

- [x] ProductType model added to `backend/prisma/schema.prisma` matching data-model.md spec
- [x] ProductType relation deferred to Sprint 3 (ADR-002)
- [x] Migration created and applied successfully (`20260209180756_add_product_type`)
- [x] Prisma Client regenerated with ProductType types available
- [x] Domain error classes created for ProductType domain
- [x] Unit tests for domain errors (5 tests)
- [x] All existing tests still pass (246 total)
- [x] Build succeeds

---

## Files to Create/Modify

| File | Purpose |
|------|---------|
| `backend/prisma/schema.prisma` | Add ProductType model |
| `backend/src/domain/errors/ProductTypeError.ts` | Domain errors for product type operations |
| `backend/src/domain/errors/ProductTypeError.test.ts` | Tests for domain errors |

---

## Implementation Steps

### Step 1: Add ProductType model to Prisma schema

Add to `backend/prisma/schema.prisma`:

```prisma
model ProductType {
  id        String   @id @default(uuid())
  name      Json     // {"es": "Camiseta", "en": "T-Shirt"}
  slug      String   @unique
  hasSizes  Boolean  @default(false) @map("has_sizes")
  isActive  Boolean  @default(true) @map("is_active")
  sortOrder Int      @default(0) @map("sort_order")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@index([slug])
  @@map("product_types")
}
```

**Note:** Do NOT add the `products Product[]` relation yet since the Product model doesn't exist. That will come in Sprint 3. Adding it now would cause a Prisma error.

### Step 2: Create and apply migration

```bash
cd backend && npx prisma migrate dev --name add_product_type
```

### Step 3: Verify Prisma Client generation

Confirm the generated types include ProductType by checking the generated Prisma client.

### Step 4: Create domain error classes

Following the existing pattern in `AuthError.ts`, create `ProductTypeError.ts` with:

- `ProductTypeError` (base class, extends Error, with `code` property)
- `ProductTypeNotFoundError` (code: `PRODUCT_TYPE_NOT_FOUND`)
- `ProductTypeSlugAlreadyExistsError` (code: `PRODUCT_TYPE_SLUG_ALREADY_EXISTS`)
- `InvalidProductTypeDataError` (code: `INVALID_PRODUCT_TYPE_DATA`)

### Step 5: Write tests for domain errors

Test that each error class:
- Has correct error code
- Has correct name
- Has correct message
- Is instance of base ProductTypeError
- Is instance of Error

---

## Technical Notes

- **Schema source of truth**: `ai-specs/specs/data-model.md` section 3.3
- **Pattern to follow**: Existing `AuthError.ts` domain error pattern (hierarchical error classes with string error codes)
- **i18n field**: The `name` field is JSONB with structure `{"es": "...", "en": "..."}`. Validation of this structure will be handled in B2.2 (service layer).
- **No relation to Product model yet**: Product model will be added in Sprint 3. Adding the relation now would break Prisma.

---

## Definition of Done

- [x] All acceptance criteria met
- [x] Unit tests written and passing
- [x] No linting errors
- [x] Build succeeds
- [x] Existing tests unaffected

---

*Ticket created: 2026-02-09*
