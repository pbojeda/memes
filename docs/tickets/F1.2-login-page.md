# F1.2: Implement Login Page

**Sprint:** 1
**Type:** Frontend - Feature
**Priority:** High
**Status:** In Progress
**Branch:** feature/sprint1-F1.2-login-page
**Created:** 2026-02-09
**Dependencies:** F1.1 (authStore), F1.5 (authService), F0.11 (OpenAPI types)

---

## Description

Create a login page at `/login` that allows users to authenticate. The page will use the existing `authService.login()` function which calls POST /auth/login and automatically updates the authStore with user data and tokens.

After successful login, redirect based on user role:
- `TARGET` role → `/` (home)
- Other roles (`MANAGER`, `ADMIN`, `MARKETING`) → `/dashboard`

Show success message if user arrives from registration (`?registered=true`).

---

## Acceptance Criteria

- [x] Login form with email and password fields
- [x] Real-time email validation (same pattern as registration)
- [x] Loading state during form submission
- [x] Error handling for invalid credentials (401)
- [x] Error handling for other API errors
- [x] Success message when arriving from registration (`?registered=true`)
- [x] Role-based redirect after login (TARGET → `/`, others → `/dashboard`)
- [x] Link "Don't have an account? Register" to `/register`
- [x] Accessible form (labels, aria attributes)
- [x] Unit tests for LoginPage component (17 tests)
- [x] All tests pass (107 total)
- [x] Build succeeds

---

## Files to Create/Modify

| File | Purpose |
|------|---------|
| `frontend/app/login/page.tsx` | Login page component |
| `frontend/components/auth/LoginForm.tsx` | Form component with validation logic |
| `frontend/components/auth/index.ts` | Add LoginForm export |
| `frontend/app/login/page.test.tsx` | Unit tests for LoginPage |
| `frontend/components/auth/LoginForm.test.tsx` | Unit tests for LoginForm |

---

## Implementation Steps

### Step 1: Create LoginForm Component

1. Create `components/auth/LoginForm.tsx`
2. State management:
   - `email`, `password` (controlled inputs)
   - `emailError` for validation error
   - `isSubmitting` boolean
   - `apiError` for server errors
3. Real-time email validation with `validateEmail()` from `lib/validations/auth.ts`
4. Form submission:
   - Validate email
   - Call `authService.login({ email, password })`
   - On success: check user role from authStore, redirect accordingly
   - On 401 error: show "Invalid email or password"
   - On other errors: show generic message
5. Include "Don't have an account? Register" link

### Step 2: Create Login Page

1. Create `app/login/page.tsx`
2. Check for `?registered=true` query param using `useSearchParams()`
3. Show success Alert if registered=true: "Registration successful! Please login."
4. Centered Card layout with:
   - Title: "Login"
   - Success message (conditional)
   - LoginForm component
5. Minimal styling with Tailwind (same pattern as register page)

### Step 3: Write Tests

1. Test `LoginForm.tsx`:
   - Renders email and password fields
   - Shows email validation error for invalid email
   - Disables submit when email is invalid or fields empty
   - Calls authService.login on submit with normalized email
   - Handles 401 error (invalid credentials)
   - Handles generic API errors
   - Redirects TARGET role to /
   - Redirects other roles to /dashboard
   - Shows link to register page

2. Test `login/page.tsx`:
   - Renders LoginForm
   - Shows success message when ?registered=true
   - Does not show success message without query param

---

## Technical Notes

### Role-Based Redirect Logic

```typescript
import { useAuthStore } from '@/stores/authStore';

const { user } = useAuthStore.getState();
if (user?.role === 'TARGET') {
  router.push('/');
} else {
  router.push('/dashboard');
}
```

### Query Params (Next.js App Router)

```typescript
'use client';
import { useSearchParams } from 'next/navigation';

const searchParams = useSearchParams();
const isFromRegistration = searchParams.get('registered') === 'true';
```

### Error Handling

- **401 Unauthorized**: Invalid credentials → show "Invalid email or password"
- **Other errors**: Show generic "Login failed. Please try again."

### Email Normalization

Same as registration - normalize email to lowercase before sending:
```typescript
await authService.login({
  email: email.trim().toLowerCase(),
  password,
});
```

### Reuse from F1.3

- Card layout pattern
- Email validation from `lib/validations/auth.ts`
- Alert component for messages
- Form structure and styling

---

## Definition of Done

- [ ] All acceptance criteria met
- [ ] Unit tests written and passing
- [ ] Code follows project standards (TypeScript, English, no `any`)
- [ ] No linting errors
- [ ] Build succeeds
- [ ] Manually tested in browser

---

## Future Enhancement (Post-MVP)

- "Remember me" checkbox for extended session persistence
- Add to PLAN_DESARROLLO.md as future task

---

*Ticket created: 2026-02-09*
