# F3.6: Implement Image Gallery Component

**Sprint:** 3
**Type:** Frontend - Feature
**Priority:** Medium
**Status:** In Progress
**Branch:** feature/sprint3-F3.6-image-gallery
**Created:** 2026-02-16
**Dependencies:** None (unblocks F3.5 - Product Detail Page)

---

## Description

Implement a reusable `ImageGallery` component for the product detail page. The gallery displays multiple product images with a large main image view and a row of clickable thumbnails for navigation. It supports keyboard navigation (arrow keys), handles single-image and no-image edge cases, and uses `next/image` for optimized loading.

This component will be consumed by F3.5 (Product Detail Page) which receives `images: ProductImage[]` from `ProductDetailResponse`.

---

## Acceptance Criteria

- [x] Main image displays the selected image at a large size with `next/image`
- [x] Thumbnail strip shows all images; clicking a thumbnail changes the main image
- [x] Active thumbnail has a visual indicator (border/ring highlight)
- [x] Arrow key navigation (Left/Right) cycles through images
- [x] Previous/Next arrow buttons for mouse navigation
- [x] Handles edge cases: 0 images (placeholder), 1 image (no thumbnails/arrows)
- [x] Images sorted by `sortOrder` before display
- [x] Alt text from `ProductImage.altText` used for accessibility
- [x] Responsive: main image fills container width, thumbnails scroll horizontally on small screens
- [x] Unit tests for all interactions and edge cases
- [x] All tests pass
- [x] Build succeeds

---

## Files to Create/Modify

| File | Purpose |
|------|---------|
| `frontend/components/product/ImageGallery.tsx` | Image gallery component |
| `frontend/components/product/ImageGallery.test.tsx` | Tests for ImageGallery |
| `frontend/components/product/testing/fixtures.ts` | Add `createProductImage` and `createProductImages` helpers |
| `frontend/components/product/index.ts` | Re-export ImageGallery |

---

## Technical Notes

- **Type:** `components['schemas']['ProductImage']` from `@/lib/api/types` — fields: `id`, `url`, `altText`, `isPrimary`, `sortOrder` (all optional)
- **Image optimization:** Use `next/image` with `fill` + `sizes` prop for main image; fixed dimensions for thumbnails
- **Sorting:** Sort images by `sortOrder` ascending, then `isPrimary: true` first as tiebreaker
- **Keyboard nav:** `onKeyDown` handler on the gallery container with `tabIndex={0}` and `role="region"` + `aria-label`
- **No-image fallback:** Reuse `ImageOff` from `lucide-react` (same pattern as `ProductCard`)
- **Client component:** Needs `'use client'` because it uses `useState` for selected image index
- **Mock `next/image`:** Filter `fill`/`sizes` props in tests (established pattern from `ProductCard.test.tsx`)
- **Established patterns:** Follow `ProductCard.tsx` for image rendering, `@/lib/utils` for `cn()` and `getLocalizedName()`

---

## Implementation Plan

### Step 0: Test Fixtures

Add `createProductImage` and `createProductImages` factory functions to `frontend/components/product/testing/fixtures.ts`.

### Step 1: No-Images Placeholder (TDD)

**RED:**
- `'should render placeholder with ImageOff icon when images is empty array'`
- `'should render placeholder when images is undefined'`

**GREEN:** Create `ImageGallery.tsx` with `'use client'`, handle empty/undefined images with `ImageOff` placeholder.

### Step 2: Single Image Rendering (TDD)

**RED:**
- `'should render main image with next/image when single image provided'`
- `'should not render thumbnail strip when only one image'`
- `'should not render navigation arrows when only one image'`

**GREEN:** Render main image with `next/image` (`fill` + `sizes`). Only show thumbnails/arrows when `images.length > 1`.

### Step 3: Multiple Images -- Main Image and Thumbnails (TDD)

**RED:**
- `'should render main image as the first image (sorted by sortOrder)'`
- `'should render thumbnail strip with all images'`
- `'should render thumbnails inside a strip container'`

**GREEN:** Add thumbnail strip below main image. Each thumbnail is a `<button>` wrapping `next/image`.

### Step 4: Thumbnail Click Interaction (TDD)

**RED:**
- `'should change main image when thumbnail is clicked'`
- `'should highlight the active thumbnail with a ring'`

**GREEN:** `useState(0)` for `selectedIndex`. Click thumbnail → `setSelectedIndex(index)`. Active thumbnail gets `ring-2 ring-primary`.

### Step 5: Previous/Next Navigation Buttons (TDD)

**RED:**
- `'should render previous and next buttons when multiple images'`
- `'should disable previous button when on first image'`
- `'should disable next button when on last image'`
- `'should navigate to next image on next button click'`
- `'should navigate to previous image on previous button click'`

**GREEN:** Add `Button` (variant="outline", size="icon") with `ChevronLeft`/`ChevronRight` positioned on main image sides. Disable at boundaries.

### Step 6: Keyboard Navigation (TDD)

**RED:**
- `'should navigate to next image on ArrowRight key'`
- `'should navigate to previous image on ArrowLeft key'`
- `'should not go below 0 on ArrowLeft at first image'`
- `'should not go past last image on ArrowRight at last image'`

**GREEN:** `onKeyDown` handler on gallery container with `tabIndex={0}`, `role="region"`, `aria-label="Product image gallery"`.

### Step 7: Sort Order (TDD)

**RED:**
- `'should sort images by sortOrder ascending'`
- `'should use isPrimary as tiebreaker when sortOrder is equal'`

**GREEN:** `useMemo` sort: `sortOrder` ascending (undefined → Infinity), then `isPrimary` descending.

### Step 8: Accessibility (TDD)

**RED:**
- `'should use altText from ProductImage for main image'`
- `'should fall back to empty string alt when altText is undefined'`
- `'should have role="region" and aria-label on gallery container'`
- `'should apply custom className to the root element'`

**GREEN:** `altText ?? ''` for alt props. `role="region"` + `aria-label`. `cn(baseClasses, className)` on root.

### Step 9: Barrel Export

Add `export { ImageGallery } from './ImageGallery'` to `frontend/components/product/index.ts`.

### Step 10: Final Validation

1. `cd frontend && npm test -- --testPathPatterns ImageGallery`
2. `cd frontend && npm run lint`
3. `cd frontend && npm run build`

### Key Imports

```ts
'use client';
import { useState, useMemo } from 'react';
import Image from 'next/image';
import { ImageOff, ChevronLeft, ChevronRight } from 'lucide-react';
import { Button } from '@/components/ui/button';
import { cn } from '@/lib/utils';
import type { components } from '@/lib/api/types';
```

### Test Mocks

```ts
jest.mock('next/image', () => {
  return function MockImage({ fill, sizes, ...props }: Record<string, unknown>) {
    return <img {...(props as React.ImgHTMLAttributes<HTMLImageElement>)} />;
  };
});

jest.mock('lucide-react', () => ({
  ImageOff: (props: Record<string, unknown>) => <svg data-testid="image-off-icon" {...props} />,
  ChevronLeft: (props: Record<string, unknown>) => <svg data-testid="chevron-left-icon" {...props} />,
  ChevronRight: (props: Record<string, unknown>) => <svg data-testid="chevron-right-icon" {...props} />,
}));
```

---

## Definition of Done

- [x] All acceptance criteria met
- [x] Unit tests written and passing
- [x] Code follows project standards
- [x] No linting errors
- [x] Build succeeds

---

*Ticket created: 2026-02-16*
