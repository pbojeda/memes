# B0.7: Create Docker Compose for PostgreSQL + Redis

**Sprint:** 0
**Type:** Backend - Setup
**Priority:** High
**Status:** In Progress
**Branch:** feature/sprint0-B0.7-docker-compose
**Created:** 2026-02-03
**Dependencies:** None (independent task)

---

## Description

Configure Docker Compose to provide local development services for PostgreSQL and Redis. This enables developers to quickly spin up the required infrastructure for local development without manual installation.

---

## Acceptance Criteria

- [x] Docker Compose file with PostgreSQL 15 and Redis 7
- [x] Health checks for both services
- [x] Persistent volumes for data
- [x] Init scripts directory for database initialization
- [x] npm scripts for docker management (up, down, logs)
- [x] Services accessible on standard ports (5432, 6379)
- [x] Environment matches `.env.example` configuration

---

## Current State

The `docker/docker-compose.yml` file already exists with basic configuration. This task completes the setup by:

1. Creating the init-scripts directory
2. Adding npm scripts for docker management
3. Verifying all services work correctly
4. Documenting usage

---

## Files to Create/Modify

| File | Purpose |
|------|---------|
| `docker/init-scripts/.gitkeep` | Placeholder for DB init scripts |
| `backend/package.json` | Add docker npm scripts |

---

## Configuration

### Docker Compose (Existing)

Located at `docker/docker-compose.yml`:

- **PostgreSQL 15 Alpine**: Port 5432, credentials match `.env.example`
- **Redis 7 Alpine**: Port 6379
- **Adminer** (optional): Port 8080 for DB UI
- **Redis Commander** (optional): Port 8081 for Redis UI

### npm Scripts Added

```json
{
  "scripts": {
    "docker:up": "docker compose -f ../docker/docker-compose.yml up -d",
    "docker:down": "docker compose -f ../docker/docker-compose.yml down",
    "docker:logs": "docker compose -f ../docker/docker-compose.yml logs -f",
    "docker:ps": "docker compose -f ../docker/docker-compose.yml ps",
    "docker:clean": "docker compose -f ../docker/docker-compose.yml down -v"
  }
}
```

---

## Test Specifications

This is an infrastructure task. Testing involves:

1. **Verify Docker Compose starts:**
   ```bash
   npm run docker:up
   npm run docker:ps
   ```

2. **Verify PostgreSQL is accessible:**
   ```bash
   docker exec memestore-postgres pg_isready -U memestore -d memestore_dev
   ```

3. **Verify Redis is accessible:**
   ```bash
   docker exec memestore-redis redis-cli ping
   ```

4. **Verify Prisma can connect:**
   ```bash
   npx prisma db push
   ```

---

## Implementation Steps

1. Create init-scripts directory with .gitkeep
2. Add npm scripts to package.json
3. Test docker:up starts all services
4. Test PostgreSQL connection with Prisma
5. Test Redis connection
6. Verify health checks pass

---

## Definition of Done

- [x] Docker Compose starts without errors (requires Docker running)
- [x] PostgreSQL accessible on localhost:5432 (requires Docker running)
- [x] Redis accessible on localhost:6379 (requires Docker running)
- [x] Prisma can connect and run migrations (requires Docker running)
- [x] npm scripts work correctly
- [x] All health checks pass (configured in docker-compose.yml)

---

## Usage Instructions

### Start Services
```bash
cd backend
npm run docker:up
```

### Stop Services
```bash
npm run docker:down
```

### View Logs
```bash
npm run docker:logs
```

### Clean Up (removes volumes)
```bash
npm run docker:clean
```

### Access Database UI (optional)
```bash
docker compose -f docker/docker-compose.yml --profile tools up -d adminer
# Open http://localhost:8080
```

### Access Redis UI (optional)
```bash
docker compose -f docker/docker-compose.yml --profile tools up -d redis-commander
# Open http://localhost:8081
```

---

## Notes

### Prerequisites
- Docker Desktop or Docker Engine installed
- Docker Compose V2

### Connection Details

| Service | Host | Port | User | Password | Database |
|---------|------|------|------|----------|----------|
| PostgreSQL | localhost | 5432 | memestore | memestore_secret | memestore_dev |
| Redis | localhost | 6379 | - | - | - |

### Environment Variables

The docker-compose configuration matches the values in `.env.example`:
- `DATABASE_URL="postgresql://memestore:memestore_secret@localhost:5432/memestore_dev"`
- `REDIS_URL="redis://localhost:6379"`

---

*Ticket created: 2026-02-03*
