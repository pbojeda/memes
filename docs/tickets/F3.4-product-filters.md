# F3.4: Implement ProductFilters Component

**Sprint:** 3
**Type:** Frontend - Feature
**Priority:** High
**Status:** In Progress
**Branch:** feature/sprint3-F3.4-product-filters
**Created:** 2026-02-16
**Dependencies:** None (F3.1 Catalog page depends on this)

---

## Description

Implement a `ProductFilters` client component that provides search, type filtering, price range filtering, and sort functionality for the product catalog. The component syncs filter state via callbacks so the parent page can update URL search params and refetch data. This is a controlled component — filter values are passed as props, changes are emitted via an `onFiltersChange` callback.

The backend API (`GET /products`) already supports: `search`, `typeSlug`, `minPrice`, `maxPrice`, `isHot`, and `sort` query parameters. Product types are fetched from `GET /product-types`.

---

## Acceptance Criteria

- [x] Search input with placeholder "Search products..." and search icon
- [x] Product type dropdown populated from a `types` prop (list of ProductType)
- [x] Price range inputs (min/max) with EUR formatting hints
- [x] Sort dropdown with options: Newest, Price: Low to High, Price: High to Low, Most Popular
- [x] "Hot" toggle filter (optional, checkbox or toggle)
- [x] `onFiltersChange` callback emits partial filter updates on each change
- [x] `value` prop receives current filter state (controlled component)
- [x] Clear/reset filters button that resets all filters to defaults
- [x] Responsive layout: horizontal on desktop, stacked on mobile
- [x] Accessible: proper labels, aria attributes, keyboard navigable
- [x] `className` prop for external styling
- [x] Unit tests for all interactions
- [x] All tests pass
- [x] Build succeeds

---

## Files to Create/Modify

| File | Purpose |
|------|---------|
| `frontend/components/product/ProductFilters.tsx` | ProductFilters component |
| `frontend/components/product/ProductFilters.test.tsx` | Tests for ProductFilters |
| `frontend/components/product/index.ts` | Re-export ProductFilters |
| `frontend/components/ui/select.tsx` | Select UI primitive (Radix-based) |

---

## Implementation Steps

### Step 1: Add Select UI Primitive
1. Install `@radix-ui/react-select` if not already installed
2. Create `components/ui/select.tsx` following shadcn/ui pattern (like existing Card, Badge, etc.)

### Step 2: Define Filter Types
1. Define `ProductFiltersValue` type: `{ search, typeSlug, minPrice, maxPrice, isHot, sort }`
2. Define `ProductFiltersProps` interface with `value`, `onFiltersChange`, `types`, `className`

### Step 3: Implement ProductFilters Component (TDD)
1. Write tests first for each filter interaction
2. Implement search input with `Search` icon from lucide-react
3. Implement type Select dropdown from `types` prop
4. Implement min/max price inputs (type="number")
5. Implement sort Select dropdown with 4 sort options
6. Implement Hot checkbox/toggle
7. Implement clear filters button
8. Responsive layout with Tailwind flex/grid

### Step 4: Export and Integrate
1. Add export to `components/product/index.ts`

---

## Technical Notes

- **Client component**: Needs `'use client'` directive since it handles user interactions
- **Controlled component**: All filter values come from props; parent owns state
- **Sort options map**: `newest` → "Newest", `price_asc` → "Price: Low to High", `price_desc` → "Price: High to Low", `popular` → "Most Popular"
- **ProductType type**: `components['schemas']['ProductType']` from generated API types
- **Localized type names**: Use `getLocalizedName()` from `lib/utils.ts` for product type display names
- **No debounce in component**: The parent page (F3.1) will handle debounce for the search input if needed
- **Existing UI primitives**: Input, Label, Button, Badge, Checkbox available in `components/ui/`
- **New UI primitive needed**: Select (Radix-based) for type and sort dropdowns
- **Existing patterns**: Follow `className` prop pattern from ProductCard/ProductGrid

---

## Implementation Plan

### Step 0: Verify Dependencies
- Confirm `radix-ui` (v1.4.3+) already includes Select — **no npm install needed**
- Confirm `lucide-react` has `Search` and `X` icons — **already installed**

### Step 1: Create Select UI Primitive
**File:** `frontend/components/ui/select.tsx`

Radix Select wrapper following shadcn/ui pattern (same as `dialog.tsx`, `dropdown-menu.tsx`):
- `'use client'` directive
- Import `Select as SelectPrimitive` from `"radix-ui"`
- `data-slot` attributes, `cn()` merging, function components
- Exports: `Select`, `SelectGroup`, `SelectValue`, `SelectTrigger`, `SelectContent`, `SelectItem`, `SelectLabel`, `SelectSeparator`, `SelectScrollUpButton`, `SelectScrollDownButton`
- `SelectTrigger` has `ChevronDownIcon`, `SelectItem` has `CheckIcon` indicator

### Step 2: Write Tests FIRST (RED phase)
**File:** `frontend/components/product/ProductFilters.test.tsx`

**Mocking strategy:** Mock `@/components/ui/select` with native HTML `<select>` elements (Radix portals don't work in JSDOM). Mock `lucide-react` icons as SVGs with `data-testid`.

**Test fixtures:**
- `mockProductTypes`: 3 types (T-shirts/tshirts, Mugs/mugs, Posters/posters)
- `defaultProps`: `{ value: {}, onFiltersChange: jest.fn() }`

**Test cases (~30 tests in 6 groups):**

#### Rendering (10 tests)
1. Renders search input with placeholder "Search products..."
2. Renders search icon
3. Renders type select when `types` prop provided
4. Hides type select when `types` is empty array
5. Hides type select when `types` is undefined
6. Renders min price input with label
7. Renders max price input with label
8. Renders sort select with 4 options (Newest, Price: Low to High, Price: High to Low, Most Popular)
9. Renders Hot checkbox with label
10. Renders clear filters button

#### Controlled values (7 tests)
11. Displays current search value from props
12. Displays current typeSlug value
13. Displays current minPrice value
14. Displays current maxPrice value
15. Displays current sort value
16. Reflects `isHot: true` as checked
17. Reflects `isHot: undefined` as unchecked

#### Interactions (8 tests)
18. Calls `onFiltersChange({ search })` on input change
19. Calls `onFiltersChange({ typeSlug })` on type select change
20. Calls `onFiltersChange({ typeSlug: undefined })` when "All types" selected
21. Calls `onFiltersChange({ minPrice })` on min price change
22. Calls `onFiltersChange({ maxPrice })` on max price change
23. Calls `onFiltersChange({ sort })` on sort change
24. Calls `onFiltersChange({ isHot: true })` on checkbox check
25. Calls `onFiltersChange({ isHot: undefined })` on checkbox uncheck

#### Clear filters (3 tests)
26. Clears all filters on click (emits all fields as `undefined`)
27. Disables clear button when no filters active
28. Enables clear button when at least one filter active

#### Accessibility (3 tests)
29. All form controls have accessible labels
30. Custom `className` applied to container
31. Keyboard-navigable controls

#### Product type names (2 tests)
32. Displays localized type names via `getLocalizedName()`
33. Falls back to slug when name is undefined

### Step 3: Create Minimal Stub (RED phase)
**File:** `frontend/components/product/ProductFilters.tsx`

Minimal stub with exported types so tests compile but all fail:
- Export `ProductFiltersValue` interface
- Export `ProductFilters` component returning `<div>TODO</div>`
- Run tests → confirm all RED

### Step 4: Implement Component (GREEN phase)
**File:** `frontend/components/product/ProductFilters.tsx`

Full implementation:
- `'use client'` directive
- Imports: `Search`, `X` from lucide; `Input`, `Label`, `Button`, `Checkbox` from ui/; `Select*` from ui/select; `cn`, `getLocalizedName` from lib/utils
- `SORT_OPTIONS` constant array
- `hasActiveFilters` derived boolean for clear button state
- Layout: `flex-col gap-4 md:flex-row md:flex-wrap md:items-end`
- Search: `Input` with `Search` icon overlay, `pl-9`
- Type: `Select` with "All types" sentinel value (Radix doesn't allow `value=""`)
- Price: two `Input type="number"` with `w-[120px]`
- Sort: `Select` with SORT_OPTIONS
- Hot: `Checkbox` + `Label`
- Clear: `Button variant="ghost"` with `X` icon, disabled when no active filters
- All values stored as strings (parent converts for API)

Run tests → confirm all GREEN

### Step 5: Refactor
- Review for repeated patterns, consistent naming
- Ensure proper TypeScript types (no `any`)
- Clean up edge cases (empty string vs undefined)

### Step 6: Update Barrel Export
**File:** `frontend/components/product/index.ts`

Add: `export { ProductFilters } from './ProductFilters'` and `export type { ProductFiltersValue } from './ProductFilters'`

### Step 7: Full Verification
1. `cd frontend && npm test` — all tests pass
2. `cd frontend && npm run lint` — no errors
3. `cd frontend && npm run build` — build succeeds

### Key Design Decisions
- **Radix Select empty value:** Use sentinel `"__all__"` for "All types", map to `undefined`
- **Price as strings:** Matches URL search params; parent converts to number for API
- **Sort default:** `'newest'` is API default; emit `undefined` when newest selected so parent can omit param
- **No debounce:** Parent page (F3.1) handles debounce for search
- **isHot:** Emit `undefined` (not `false`) when unchecked so parent can omit param

---

## Definition of Done

- [x] All acceptance criteria met
- [x] Unit tests written and passing
- [x] Code follows project standards
- [x] No linting errors
- [x] Build succeeds

---

*Ticket created: 2026-02-16*
