# F3.2: Implement ProductCard Component

**Sprint:** 3
**Type:** Frontend - Feature
**Priority:** High
**Status:** In Progress
**Branch:** feature/sprint3-F3.2-product-card
**Created:** 2026-02-16
**Dependencies:** None (B3.3–B3.5 provide the API; no frontend deps)

---

## Description

Create a reusable `ProductCard` component that displays a product summary in the catalog grid. The card shows the product image, title, price (with optional compare-at price), "Hot" badge, average rating, and links to the product detail page.

This is a presentational component — it receives a `Product` object as a prop and renders it. No data fetching or state management inside the card itself.

---

## Acceptance Criteria

- [x] Renders product primary image with alt text (fallback placeholder when no image)
- [x] Displays localized product title (using `getLocalizedName` for JSON titles)
- [x] Shows current price formatted as currency
- [x] Shows compare-at price with strikethrough when present and higher than price
- [x] Displays "Hot" badge when `isHot` is true, hidden otherwise
- [x] Shows average rating with star indicator and review count
- [x] Entire card links to `/products/{slug}` detail page
- [x] Responsive: works in grid layouts (no fixed width)
- [x] Accessible: proper alt text, semantic HTML, keyboard-navigable link
- [x] Uses existing UI primitives: `Card`, `Badge` from `components/ui/`
- [x] Unit tests for all visual states (TDD)
- [x] All tests pass
- [x] Build succeeds

---

## Files to Create/Modify

| File | Purpose |
|------|---------|
| `frontend/components/product/ProductCard.tsx` | ProductCard component |
| `frontend/components/product/ProductCard.test.tsx` | Unit tests (TDD) |
| `frontend/components/product/index.ts` | Barrel export |

---

## Implementation Steps

### Step 1: Define Props Type
1. Import `components` from `@/lib/api/types`
2. Define `ProductCardProps` using `components['schemas']['Product']`

### Step 2: Write Tests (TDD — Red)
1. Test renders product title
2. Test renders product image with alt text
3. Test renders placeholder when no primary image
4. Test renders price formatted as currency
5. Test renders compare-at price with strikethrough when present
6. Test hides compare-at price when not present or equal to price
7. Test shows Hot badge when `isHot` is true
8. Test hides Hot badge when `isHot` is false
9. Test shows average rating and review count
10. Test links to `/products/{slug}`
11. Test accessibility (img alt, link role)

### Step 3: Implement Component (TDD — Green)
1. Build minimal component to pass each test
2. Use `Card` from `components/ui/card` as wrapper
3. Use `Badge` for Hot indicator
4. Use `next/link` for navigation
5. Use `next/image` for optimized images
6. Use `getLocalizedName` for title
7. Format price with `Intl.NumberFormat` or simple template

### Step 4: Refactor & Polish
1. Extract price formatting if reusable
2. Ensure Tailwind classes follow design system tokens
3. Verify responsive behavior

---

## Technical Notes

- **Product type:** `components['schemas']['Product']` from auto-generated `lib/api/types.ts`
- **Localized title:** The `title` field comes pre-localized from the API based on `Accept-Language` header, but may also arrive as a JSON object `{es: "...", en: "..."}` — use `getLocalizedName()` from `lib/utils.ts`
- **Image optimization:** Use `next/image` with proper `sizes` attribute for responsive loading
- **Price display:** Format as EUR currency (Spanish locale for MVP)
- **Design system:** Use `Card`, `Badge` from `components/ui/`, Tailwind 4 tokens, `lucide-react` icons if needed (e.g., Star icon for rating)
- **No data fetching:** This is a pure presentational component — parent provides the `Product` object
- **Next.js Image domains:** May need to configure `next.config.ts` for Cloudinary image domains

---

## Implementation Plan

### Step 1: Configure `next/image` for Cloudinary domains
- **File:** `frontend/next.config.ts`
- Add `images.remotePatterns` for `res.cloudinary.com` (product images are stored on Cloudinary)

### Step 2: Create barrel export
- **File:** `frontend/components/product/index.ts`
- Export `ProductCard` — follow pattern from `components/product-types/index.ts`

### Step 3: Define Props interface (in component file)
```typescript
type Product = components['schemas']['Product'];
interface ProductCardProps {
  product: Product;
  className?: string;
}
```

### Step 4: Write all tests first (TDD — Red)
- **File:** `frontend/components/product/ProductCard.test.tsx`
- Mock `next/link` and `next/image` (established mock patterns)
- Factory function `createProduct()` with sensible defaults

**Test cases (~14 tests in 6 describe blocks):**
1. **Title:** renders product title; handles localized title via `getLocalizedName`
2. **Image:** renders image with alt text; shows placeholder when no image; shows placeholder when URL missing
3. **Price:** renders EUR-formatted price; shows compare-at with strikethrough when higher; hides compare-at when absent; hides compare-at when equal/lower
4. **Hot badge:** shows when `isHot: true`; hidden when `isHot: false`
5. **Rating:** shows average + count when reviews exist; hidden when no reviews
6. **Navigation:** card links to `/products/{slug}`
7. **Accessibility:** `<h3>` for title, proper alt text, keyboard-navigable link

### Step 5: Implement component (TDD — Green)
- **File:** `frontend/components/product/ProductCard.tsx`
- **Structure:**
  - `Card` (with `overflow-hidden py-0 group`) wrapping a single `Link` to `/products/{slug}`
  - Image area: `aspect-square` container with `next/image` (fill + object-cover) or placeholder div
  - `Badge variant="destructive"` absolutely positioned for Hot indicator
  - `CardContent`: `<h3>` with `line-clamp-2` for title
  - `CardFooter`: price row (current + strikethrough compare-at) and rating row (`Star` icon from lucide-react + count)
- **Price:** `Intl.NumberFormat('es-ES', { style: 'currency', currency: 'EUR' })` via local `formatPrice()` helper
- **Image fallback:** Placeholder `<div>` with `aria-label="No product image"` and camera emoji
- **Rating:** `Star` from lucide-react, filled yellow — only shown when `reviewsCount > 0`
- **Hover:** `group-hover:scale-105` on image for subtle zoom

### Step 6: Refactor
- Review `formatPrice` placement (keep co-located unless reused)
- Verify Tailwind classes match design tokens
- Confirm responsive behavior (no fixed width, relies on parent grid)

### Step 7: Verify
```bash
cd frontend && npm test
cd frontend && npm run lint
cd frontend && npm run build
```

### Files Summary

| File | Action | Purpose |
|------|--------|---------|
| `frontend/next.config.ts` | Modify | Add Cloudinary remotePatterns |
| `frontend/components/product/ProductCard.test.tsx` | Create | TDD tests (written first) |
| `frontend/components/product/ProductCard.tsx` | Create | ProductCard component |
| `frontend/components/product/index.ts` | Create | Barrel export |

### Edge Cases Handled
- `primaryImage` undefined → placeholder
- `primaryImage.url` undefined → placeholder
- `compareAtPrice` undefined → no strikethrough
- `compareAtPrice ≤ price` → no strikethrough
- `reviewsCount` 0 or undefined → no rating section
- `title` undefined → empty string via `getLocalizedName`
- `slug` undefined → links to `/products/`

---

## Definition of Done

- [x] All acceptance criteria met
- [x] Unit tests written and passing
- [x] Code follows project standards (TypeScript, Tailwind, component patterns)
- [x] No linting errors
- [x] Build succeeds
- [x] ProductCard ready for use in ProductGrid (F3.3)

---

*Ticket created: 2026-02-16*
