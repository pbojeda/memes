# F4.4: Create Cart Page

**Sprint:** 4
**Type:** Frontend - Feature
**Priority:** High
**Status:** In Progress
**Branch:** feature/sprint4-F4.4-cart-page
**Created:** 2026-02-19
**Dependencies:** F4.1 (cartStore), F4.3 (CartItem component) — both complete

---

## Description

Create the `/cart` route page that CartDrawer's "View Cart" button links to. This is a full-page cart view where users can review their items, adjust quantities, remove items, and proceed to checkout. Unlike the CartDrawer (a compact slide-out), the cart page provides a spacious layout with a clear order summary section.

---

## Acceptance Criteria

- [x] Route `/cart` renders the cart page
- [x] Displays list of cart items using the existing `CartItem` component
- [x] Each item shows image, title, size (if any), unit price, quantity controls, line total, remove button (via CartItem)
- [x] Shows order summary section: subtotal, item count
- [x] "Proceed to Checkout" button links to `/checkout` (route doesn't exist yet — just the link)
- [x] "Continue Shopping" link back to `/products`
- [x] Empty cart state: message + CTA to browse products
- [x] Cart hydrates on mount (skipHydration pattern)
- [x] Page is responsive (stacked layout on mobile, side-by-side on desktop)
- [x] Unit tests for cart page component
- [x] All tests pass
- [x] Build succeeds

---

## Files to Create/Modify

| File | Purpose |
|------|---------|
| `frontend/app/cart/page.tsx` | Cart page route |
| `frontend/components/cart/CartPageContent.tsx` | Client component with cart page logic |
| `frontend/components/cart/__tests__/CartPageContent.test.tsx` | Tests for CartPageContent |

---

## Implementation Steps

### Step 1: Create CartPageContent client component
1. `'use client'` component that reads from cartStore
2. Hydrates on mount with `useCartStore.persist.rehydrate()`
3. Renders cart items list using `CartItem` component
4. Renders order summary sidebar (subtotal, item count)
5. Renders "Proceed to Checkout" button (links to `/checkout`)
6. Renders "Continue Shopping" link (links to `/products`)
7. Renders empty state when cart has no items

### Step 2: Create cart page route
1. Server component at `app/cart/page.tsx`
2. Renders `CartPageContent` inside a `<main>` wrapper
3. Exports metadata with title "Cart | MemeStore"

### Step 3: Write Tests (TDD — tests first)
1. Test empty cart renders empty state message and "Continue Shopping" link
2. Test cart with items renders CartItem for each item
3. Test subtotal and item count are displayed
4. Test "Proceed to Checkout" button is present and links to `/checkout`
5. Test "Continue Shopping" link is present and links to `/products`
6. Test quantity update calls store's updateQuantity
7. Test remove calls store's removeItem

---

## Technical Notes

- **Reuse CartItem**: The existing `CartItem` component handles image, title, size, price, quantity controls, and remove — no need to duplicate.
- **cartStore hydration**: Must call `useCartStore.persist.rehydrate()` on mount since store uses `skipHydration: true`.
- **formatPrice**: Use `formatPrice()` from `@/lib/utils` for consistent price formatting.
- **Layout**: Desktop: two-column (items list + order summary sidebar). Mobile: stacked (items first, summary below).
- **Test mocking**: Mock `cartStore` in tests. Mock `next/link` and `next/image` as needed. Use `createCartItem` fixture from `components/cart/testing/fixtures.ts`.

---

## Implementation Plan

### File Naming Convention

The project convention is co-located test files as siblings (not `__tests__/`):

| File | Purpose |
|------|---------|
| `frontend/components/cart/CartPageContent.test.tsx` | Tests (TDD — written first) |
| `frontend/components/cart/CartPageContent.tsx` | Client component with cart page logic |
| `frontend/app/cart/page.tsx` | Server component route with metadata |

---

### Phase 1: Test File (`CartPageContent.test.tsx`) — Write First (TDD Red)

#### 1.1 Mock Strategy

Follow the exact patterns from `CartDrawer.test.tsx`:

- **Mock `../../stores/cartStore`** (relative path, NOT `@/`): module-level `let` vars for `mockItems`, `mockItemCount`, `mockSubtotal`, `mockUpdateQuantity`, `mockRemoveItem`. Selector-based mock. Attach `persist.rehydrate` via `beforeAll` + `require()`.
- **Mock `./CartItem`** (relative path): render simplified `<div data-testid={cart-item-${item.productId}-${item.size ?? 'no-size'}}>`. Capture `onUpdateQuantity` and `onRemove` callbacks for wiring tests.
- **Mock `next/link`**: render as `<a href={href}>`.
- **Mock `next/image`**: render as `<img>`.
- **`afterEach`**: clear all mocks and reset mock state variables.

#### 1.2 Test Groups

**Group A: Empty Cart State**
1. Renders "Your cart is empty" message when cart has no items
2. Renders "Continue Shopping" link pointing to `/products`
3. Does not render order summary when cart is empty
4. Does not render any CartItem when cart is empty

**Group B: Cart With Items**
1. Renders one CartItem per item in the store
2. Renders page heading "Shopping Cart"
3. Displays formatted subtotal
4. Displays item count in summary
5. Does not render empty state message when items exist

**Group C: Navigation Links**
1. Renders "Proceed to Checkout" button/link pointing to `/checkout`
2. Renders "Continue Shopping" link pointing to `/products` when cart has items

**Group D: Store Wiring**
1. Wires onUpdateQuantity to store.updateQuantity
2. Wires onRemove to store.removeItem

**Group E: Hydration**
1. Calls `useCartStore.persist.rehydrate()` on mount

**Group F: Accessibility**
1. Page has an h1 heading
2. Items list uses semantic list markup (ul/li)

---

### Phase 2: CartPageContent Component (`CartPageContent.tsx`) — TDD Green

#### 2.1 Component Structure

```
CartPageContent ('use client')
├── useEffect → rehydrate cart store on mount
├── Read from cartStore: items, itemCount, subtotal, updateQuantity, removeItem
│
├── <main className="container mx-auto px-4 py-8">
│   ├── <h1> "Shopping Cart" </h1>
│   │
│   ├── IF items.length === 0:
│   │   └── Empty State
│   │       ├── Icon (ShoppingBag from lucide-react)
│   │       ├── "Your cart is empty" message
│   │       └── <Link href="/products"> "Continue Shopping" </Link>
│   │
│   └── IF items.length > 0:
│       └── Responsive Grid (lg:grid-cols-3, gap-8)
│           ├── Items Column (lg:col-span-2)
│           │   └── <ul className="divide-y">
│           │       └── items.map → <li key=...> <CartItem .../> </li>
│           │
│           └── Order Summary Column (lg:col-span-1)
│               └── <Card> (sticky top-24)
│                   ├── CardHeader: "Order Summary"
│                   ├── CardContent: Items count + Subtotal rows
│                   └── CardFooter: "Proceed to Checkout" + "Continue Shopping"
```

#### 2.2 Key Implementation Details

- **Store selectors**: Individual selectors like CartDrawer (not destructured)
- **CartItem key**: `${item.productId}-${item.size ?? 'no-size'}` (same as CartDrawer)
- **formatPrice**: Import from `@/lib/utils`
- **h1 heading**: Render in both empty and populated states for accessibility

#### 2.3 Responsive Layout (Tailwind)

- **Container**: `container mx-auto px-4 py-8`
- **Grid**: `grid lg:grid-cols-3 gap-8` (single column on mobile, 3-col on desktop)
- **Items column**: `lg:col-span-2`
- **Summary column**: `lg:col-span-1`, card is `sticky top-24`

---

### Phase 3: Cart Page Route (`app/cart/page.tsx`) — Server Component

```typescript
import type { Metadata } from 'next';
import { CartPageContent } from '@/components/cart/CartPageContent';

export const metadata: Metadata = {
  title: 'Cart | MemeStore',
};

export default function CartPage() {
  return <CartPageContent />;
}
```

Server component exports `metadata`, delegates rendering to client component.

---

### Phase 4: Refactor and Polish (TDD Refactor)

1. Verify no logic duplication with CartItem
2. Confirm no `any` types
3. Run `npm run lint` and `npm run build`

---

### TDD Execution Order

| Step | Action |
|------|--------|
| 1 | Write ALL test cases (Groups A-F) |
| 2 | Run tests — all fail (RED) |
| 3 | Create `CartPageContent.tsx` with empty state only |
| 4 | Run tests — Group A passes |
| 5 | Add populated cart rendering (items list + summary) |
| 6 | Run tests — Groups A-D pass |
| 7 | Add hydration useEffect |
| 8 | Run tests — all pass (GREEN) |
| 9 | Create `app/cart/page.tsx` server wrapper |
| 10 | Run full test suite + lint + build |

---

## Definition of Done

- [x] All acceptance criteria met
- [x] Unit tests written and passing
- [x] Code follows project standards
- [x] No linting errors
- [x] Build succeeds

---

*Ticket created: 2026-02-19*
