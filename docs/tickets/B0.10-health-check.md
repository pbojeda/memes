# B0.10: Setup Health Check Endpoint

**Sprint:** 0
**Type:** Backend - Core
**Priority:** Low
**Status:** In Progress
**Branch:** feature/sprint0-B0.10-health-check
**Created:** 2026-02-04
**Dependencies:** B0.9 (Response Helpers)

---

## Description

Create a health check endpoint (`GET /health`) that verifies the API is running and its dependencies (database) are accessible. This endpoint is essential for:
- Container orchestration health probes (Kubernetes, Docker)
- Load balancer health checks
- Monitoring and alerting systems

---

## Acceptance Criteria

- [x] `GET /health` endpoint returns 200 when API is healthy
- [x] Response includes API status, version, and timestamp
- [x] Response includes database connection status
- [x] Returns 503 Service Unavailable when database is down
- [x] Endpoint uses existing response helpers
- [x] Unit tests with 90%+ coverage
- [x] Integration test verifies endpoint works

---

## Files to Create/Modify

| File | Purpose |
|------|---------|
| `backend/src/application/services/healthService.ts` | Health check business logic |
| `backend/src/application/services/healthService.test.ts` | Service unit tests |
| `backend/src/presentation/controllers/healthController.ts` | HTTP request handler |
| `backend/src/presentation/controllers/healthController.test.ts` | Controller unit tests |
| `backend/src/routes/healthRoutes.ts` | Route definition |
| `backend/src/routes/index.ts` | Central route aggregator |
| `backend/src/app.ts` | Register routes |

---

## API Specification

### GET /health

**Response (200 OK):**
```json
{
  "success": true,
  "data": {
    "status": "healthy",
    "version": "0.1.0",
    "timestamp": "2026-02-04T10:30:00.000Z",
    "services": {
      "database": {
        "status": "healthy",
        "latency": 5
      }
    }
  }
}
```

**Response (503 Service Unavailable):**
```json
{
  "success": false,
  "error": {
    "message": "Service unhealthy",
    "code": "SERVICE_UNAVAILABLE"
  },
  "data": {
    "status": "unhealthy",
    "version": "0.1.0",
    "timestamp": "2026-02-04T10:30:00.000Z",
    "services": {
      "database": {
        "status": "unhealthy",
        "error": "Connection refused"
      }
    }
  }
}
```

---

## Implementation Steps

### Step 1: Create Health Service (TDD)
1. Write tests for `healthService.ts`
2. Implement `checkHealth()` method
3. Implement `checkDatabase()` helper

### Step 2: Create Health Controller (TDD)
1. Write tests for `healthController.ts`
2. Implement `getHealth()` handler

### Step 3: Create Routes
1. Create `healthRoutes.ts`
2. Create `routes/index.ts` aggregator
3. Register routes in `app.ts`

### Step 4: Integration Test
1. Test endpoint with supertest

---

## Test Specifications

### Service Tests (`healthService.test.ts`)

**Successful Cases:**
- `should return healthy status when database is connected`
- `should include version from package.json`
- `should include timestamp`
- `should include database latency`

**Error Cases:**
- `should return unhealthy status when database connection fails`
- `should include error message when database is down`

### Controller Tests (`healthController.test.ts`)

**Successful Cases:**
- `should return 200 when all services are healthy`
- `should call healthService.checkHealth()`

**Error Cases:**
- `should return 503 when service is unhealthy`
- `should handle unexpected errors`

---

## Definition of Done

- [x] Health service implemented with tests
- [x] Health controller implemented with tests
- [x] Routes configured
- [x] `GET /health` returns correct response
- [x] 503 returned when database is down
- [x] All tests passing
- [x] Lint passes
- [x] Sprint deliverable "Basic API health endpoint responding" satisfied

---

## Notes

### Future Enhancements
- Add Redis health check when Redis client is implemented
- Add detailed endpoint (GET /health/detailed) for debugging
- Add metrics endpoint (GET /metrics) for Prometheus

### Response Time
- Health check should complete within 5 seconds
- Individual service checks should timeout after 3 seconds

---

*Ticket created: 2026-02-04*
