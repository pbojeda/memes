---
description: This document contains all development rules and guidelines for this project, applicable to all AI agents (Claude, Cursor, Codex, Gemini, etc.).
alwaysApply: true
---

## 1. Core Principles

- **Small tasks, one at a time**: Always work in baby steps, one at a time. Never go forward more than one step.
- **Test-Driven Development**: Write tests before implementation code.
  - For setup tasks (installing deps, config): Test the resulting configuration works
  - For logic/services: Red-Green-Refactor cycle strictly
  - For UI components: Test user interactions, not implementation details
- **Type Safety**: All code must be fully typed. Never use `any` unless absolutely necessary.
- **Clear Naming**: Use clear, descriptive names for all variables and functions.
- **Incremental Changes**: Prefer incremental, focused changes over large, complex modifications.
- **Question Assumptions**: Always question assumptions and inferences.
- **Pattern Detection**: Detect and highlight repeated code patterns.

## 2. Language Standards

- **English Only**: All technical artifacts must always use English, including:
    - Code (variables, functions, classes, comments, error messages, log messages)
    - Documentation (README, guides, API docs)
    - Jira tickets (titles, descriptions, comments)
    - Data schemas and database names
    - Configuration files and scripts
    - Git commit messages
    - Test names and descriptions

## 3. Monorepo Directory Rules

This project is a **monorepo** with separate directories for backend and frontend:

```
memes/
‚îú‚îÄ‚îÄ backend/     ‚Üê Node.js/Express backend (has its own package.json)
‚îú‚îÄ‚îÄ frontend/    ‚Üê Next.js frontend (has its own package.json)
‚îî‚îÄ‚îÄ docs/        ‚Üê Documentation (no package.json)
```

### Critical Rules

- **ALWAYS verify the current directory** before running `npm install`, `npm test`, or any npm command
- **NEVER install dependencies in the root directory** - each subproject has its own `package.json`
- **Use absolute paths** when running commands: `cd /path/to/backend && npm install`
- **Check pwd** if unsure: run `pwd` before npm commands

### Directory-Specific Commands

| Action | Correct | Wrong |
|--------|---------|-------|
| Install backend dep | `cd backend && npm install express` | `npm install express` (from root) |
| Run backend tests | `cd backend && npm test` | `npm test` (from root) |
| Install frontend dep | `cd frontend && npm install react` | `npm install react` (from root) |

## 4. Pre-Commit Checklist

Before every commit, verify ALL of the following:

1. **Tests pass**: `npm test`
2. **Lint passes**: `npm run lint`
3. **Build succeeds**: `npm run build`
4. **Production validator passed**: Run `production-code-validator` agent for significant changes
5. **Ticket updated**: Mark acceptance criteria as `[x]` for each completed item

**Never commit if any step fails.** Fix issues first.

## 5. Quality Gates

For significant code changes, use these specialized agents:

| Agent | When to Use |
|-------|-------------|
| `production-code-validator` | Before every commit - checks for debug code, TODOs, hardcoded values |
| `code-review-specialist` | For complex implementations or before merging PRs |
| `database-architect` | Schema design, migrations, query optimization |
| `backend-developer` | DDD patterns, service implementation |
| `frontend-developer` | React components, state management |

## 6. Project Memory System

This project maintains institutional knowledge in `docs/project_notes/` for consistency across sessions.

### Memory Files

- **sprint-X-tracker.md** - Sprint progress, active task, task status, and completion log
- **bugs.md** - Bug log with dates, solutions, and prevention notes
- **decisions.md** - Architectural Decision Records (ADRs) with context and trade-offs
- **key_facts.md** - Project configuration, credentials, ports, important URLs

### Workflow Tracking

- **Sprint tracker** (`sprint-X-tracker.md`) is the single source of truth for:
  - Current sprint progress
  - Active task status
  - Task completion log
- **Tickets** (`docs/tickets/`) contain detailed task specifications

### Memory-Aware Protocols

**Before proposing architectural changes:**
- Check `docs/project_notes/decisions.md` for existing decisions
- Verify the proposed approach doesn't conflict with past choices
- If it does conflict, acknowledge the existing decision and explain why a change is warranted

**When encountering errors or bugs:**
- Search `docs/project_notes/bugs.md` for similar issues
- Apply known solutions if found
- Document new bugs and solutions when resolved

**When looking up project configuration:**
- Check `docs/project_notes/key_facts.md` for credentials, ports, URLs, service accounts
- Prefer documented facts over assumptions

**When completing task steps:**
- Update ticket acceptance criteria with `[x]` as each item is verified
- Never commit without updating the ticket first

**When completing work on tasks:**
- Update the sprint tracker's "Active Task" section during work
- Add entry to "Completion Log" when task is merged

**When user requests memory updates:**
- Update the appropriate memory file (bugs, decisions, key_facts)
- Follow the established format and style (bullet lists, dates, concise entries)

## 7. Post-Compact Protocol

After any context compaction (`/compact` or automatic), BEFORE continuing work:

1. **Read the active skill file** (`.claude/skills/*/SKILL.md`) to restore workflow knowledge
2. **Read sprint tracker** (`docs/project_notes/sprint-X-tracker.md`) to verify current step and pending checkpoints
3. **Do NOT proceed past any üõë checkpoint** without explicit user confirmation
4. **If "Active Task" shows a pending checkpoint**, ask user for approval before continuing

This protocol exists because compaction summaries capture *what* you were doing but lose *how* to do it correctly. The skill files define the "how".

## 8. Anti-Patterns (Avoid)

- **Not updating ticket acceptance criteria** `[x]` as each item is completed
- **Installing dependencies in root directory** instead of `backend/` or `frontend/`
- **Creating new files** when existing ones can be extended
- **Adding features or "improvements"** not explicitly requested
- **Using `any` type** in TypeScript without explicit justification

## 9. Specific Standards

For detailed standards and guidelines specific to different areas of the project, refer to:

- [Backend Standards](./ai-specs/specs/backend-standards.mdc) - API development, database patterns, testing, security and backend best practices
- [Frontend Standards](./ai-specs/specs/frontend-standards.mdc) - React components, UI/UX guidelines, and frontend architecture
- [Documentation Standards](./ai-specs/specs/documentation-standards.mdc) - Technical documentation structure, formatting, and maintenance guidelines

## 10. Related Documentation

- [Architecture](./docs/ARQUITECTURA.md) - System architecture with diagrams
- [Business Requirements](./docs/NEGOCIO.md) - Business context and requirements
- [Data Model](./ai-specs/specs/data-model.md) - Database schema documentation
- [API Specification](./ai-specs/specs/api-spec.yaml) - OpenAPI specification
- [Use Cases](./docs/use-cases.md) - Use Cases
- [Development Guide](./ai-specs/specs/development-guide.md) - Development Guide
